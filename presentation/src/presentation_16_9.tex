%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TUM-Vorlage: Präsentation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Rechteinhaber:
%     Technische Universität München
%     https://www.tum.de
% 
% Gestaltung:
%     ediundsepp Gestaltungsgesellschaft, München
%     http://www.ediundsepp.de
% 
% Technische Umsetzung:
%     eWorks GmbH, Frankfurt am Main
%     http://www.eworks.de
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Zur Wahl des Seitenverhältnisses bitte einen der beiden folgenden Befehle
% auskommentieren und den ausführen lassen:
\input{praeambel_16_9.tex} % Seitenverhältnis 16:9
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{settings.tex}                    % !!! DATEI ANPASSEN !!!
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\Datum}{\today}

\renewcommand{\PraesentationFusszeileZusatz}{Rechnerarchitektur-Großpraktikum 2021 | Statische Binärübersetzung von RISC-V in x86-64}

\title{Statische Binärübersetzung von RISC-V in x86-64}
\author{Lukas Döllerer, Jonathan Hettwer, Johannes Maier, Tobias Schwarz, Felix Solcher}
\institute[]{Rechnerarchitektur-Großpraktikum 2021}
\date[\Datum]{Garching, 16. Juli 2021}
\subject{Statische Binärübersetzung von RISC-V in x86-64}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{entry.tex} % !!! NICHT ENTFERNEN !!!
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% FOLIENSTIL: Standard
\PraesentationMasterStandard

\PraesentationTitelseite % Fügt die Startseite ein

% TODO: Create Program Flow Diagram

%draws an arrow from (#2,#3) to (#2+#4,#3) with height of #5 (arrow in x direction)
%color, startX, startY, length (X dir), height (Y dir)
\newcommand{\TikZArrowX}[5]{\draw[#1] (#2,#3) -- (#2,#3+#5*2/3) -- (#2+#4/2,#3+#5*2/3) -- (#2+#4/2,#3+#5) -- (#2+#4,#3) -- (#2+#4/2,#3-#5) -- (#2+#4/2,#3-#5*2/3) -- (#2,#3-#5*2/3) -- (#2,#3);}

%draws an arrow from #2,#3) to (#2,#3+#5) with height of #4 (arrow in y direction)
%color, startX, startY, length (X dir), height (Y dir)
\newcommand{\TikZArrowY}[5]{\draw[#1] (#2,#3) -- (#2+#4*2/3,#3) -- (#2+#4*2/3,#3+#5/2) -- (#2+#4,#3+#5/2) -- (#2,#3+#5) -- (#2-#4,#3+#5/2) -- (#2-#4*2/3,#3+#5/2) -- (#2-#4*2/3,#3) -- (#2,#3);}

%draws the schematic presentation of the program
%scale, fontSize
\newcommand{\ProgramSchemeVersionOne}[2]{
    \begin{center}
        \begin{tikzpicture}[very thick, scale=#1]
            \draw[TUMBlau] (-2,-2) rectangle (2,2);
            \node[align=center] at (0,0) (riscv_text) {\fontsize{#2}{#2} \selectfont RISC-V};
            \TikZArrowX{TUMBlau}{2}{0}{6}{1.5}
            \node[align=center] at (4.5,0) (lifter_text) {\fontsize{#2}{#2} \selectfont Lifter};
            \draw[TUMBlau] (8,-2) rectangle (12,2);
            \node[align=center] at (10,0) (ir_text_1) {\fontsize{#2}{#2} \selectfont IR};
            \TikZArrowX{TUMBlau}{12}{0}{6}{1.5}
            \node[align=center] at (14.5,0) (optimizer_text) {\fontsize{#2}{#2} \selectfont Optimizer};
            \draw[TUMBlau] (18,-2) rectangle (22, 2);
            \node[align=center] at (20,0) (ir_text_2) {\fontsize{#2}{#2} \selectfont IR};
            \TikZArrowX{TUMBlau}{22}{0}{6}{1.5}
            \node[align=center] at (24.5,0) (compiler_text) {\fontsize{#2}{#2} \selectfont Compiler};
            \draw[TUMBlau] (28,-2) rectangle (32,2);
            \node[align=center] at (30,0) (x86_64_text) {\fontsize{#2}{#2} \selectfont x86\_64};
        \end{tikzpicture}
    \end{center}
}

\newcommand{\ProgramSchemeVersionTwo}[2]{
    \begin{center}
        \begin{tikzpicture}[very thick, scale=#1]
            \draw[TUMBlau] (-2,-2) rectangle (2,2);
            \node[align=center] at (0,0) (riscv_text) {\fontsize{#2}{#2} \selectfont RISC-V};
            \TikZArrowX{TUMBlau}{2}{0}{6}{1.5}
            \node[align=center] at (4.5,0) (lifter_text) {\fontsize{#2}{#2} \selectfont Lifter};
            \draw[TUMBlau] (8,-2) rectangle (12,2);
            \node[align=center] at (10,0) (ir_text_1) {\fontsize{#2}{#2} \selectfont IR};
            \TikZArrowY{TUMBlau}{10}{-2}{1.5}{-6}
            \node[align=center] at (10,-4) (optimizer_text) {\fontsize{#2}{#2} \selectfont Optimizer};
            \draw[TUMBlau] (8,-8) rectangle (12, -12);
            \node[align=center] at (10,-10) (ir_text_2) {\fontsize{#2}{#2} \selectfont IR};
            \TikZArrowX{TUMBlau}{8}{-10}{-6}{1.5}
            \node[align=center] at (5.5,-10) (compiler_text) {\fontsize{#2}{#2} \selectfont Compiler};
            \draw[TUMBlau] (-2,-8) rectangle (2,-12);
            \node[align=center] at (0,-10) (x86_64_text) {\fontsize{#2}{#2} \selectfont x86\_64};
        \end{tikzpicture}
    \end{center}
}

\newcommand{\ProgramSchemeVersionThree}[2]{
    \begin{center}
        \begin{tikzpicture}[very thick, scale=#1]
            \draw[TUMBlau] (-2,-2) rectangle (2,2);
            \node[align=center] at (0,0) (riscv_text) {\fontsize{#2}{#2} \selectfont RISC-V};
            \TikZArrowX{TUMBlau}{2}{0}{6}{1.5}
            \node[align=center] at (4.5,0) (lifter_text) {\fontsize{#2}{#2} \selectfont Lifter};
            \draw[TUMBlau] (8,-2) rectangle (12,2);
            \node[align=center] at (10,0) (ir_text_1) {\fontsize{#2}{#2} \selectfont IR};
            \TikZArrowY{TUMBlau}{10}{-2}{1.5}{-6}
            \node[align=center] at (10,-4) (optimizer_text) {\fontsize{#2}{#2} \selectfont Optimizer};
            \draw[TUMBlau] (8,-8) rectangle (12, -12);
            \node[align=center] at (10,-10) (ir_text_2) {\fontsize{#2}{#2} \selectfont IR};
            \TikZArrowX{TUMBlau}{12}{-10}{6}{1.5}
            \node[align=center] at (14.5,-10) (compiler_text) {\fontsize{#2}{#2} \selectfont Compiler};
            \draw[TUMBlau] (18,-8) rectangle (22,-12);
            \node[align=center] at (20,-10) (x86_64_text) {\fontsize{#2}{#2} \selectfont x86\_64};
        \end{tikzpicture}
    \end{center}
}

\begin{frame}
    \frametitle{Programmschma, Version 1}
    %alignment to have some space between headline an the schematic
    ~\\
    ~\\
    \ProgramSchemeVersionOne{0.6}{18}
\end{frame}

\begin{frame}
    \frametitle{Programmschema, Version 2}
    \ProgramSchemeVersionTwo{0.6}{18}
\end{frame}

\begin{frame}
    \frametitle{Programmschema, Version 3}
    \ProgramSchemeVersionThree{0.6}{18}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% ELF File Parser Folie %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
    \frametitle{Lifter}{ELF Binärdatei laden und Instruktionsbytes dekodieren}

    \begin{enumerate}
        \item ELF File auf korrekte Attribute prüfen (Prüfbits, OS, Class, ...).
        \item Program Header, Sections und (falls vorhanden) Symbole auslesen.
        \item Dekodiere alle Bytes in ausführbaren Sections oder ausführbaren Programmheadern zu Instruktionen mittels \textbf{frvdec}.
    \end{enumerate}
\end{frame}
\clearpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Lifter Folie %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
    \frametitle{Lifter}{RISC-V Instruktionen in IR Code umwandeln}

    \begin{enumerate}
        \setlength\itemsep{0.5em}
        \item Instruktionen nach Kontrollfluss einlesen (Start bei ELF Einstiegspunkt)
        \begin{itemize}
            \setlength\itemsep{0.5em}
            \item Rekursives Vorgehen
            \item Instruktionen sequenziell in entsprechende Folge von Instruktionen in der IR umwandeln.
            \item Wiederhole bis eine \textbf{Kontrollfluss ändernde Instruktion} auftritt.
            \item Diese wird in zwei Kontrollflussänderungen bei bedingten Sprüngen gespalten.
            \item Aktueller Basic Block wird beendet und für jede Kontrollflussänderung wird eine neuer Block gestartet der weiter rekursiv eingelesen wird. 
        \end{itemize}
        \item Sollte Schritt 1 nicht alle vorhandenen Instruktionen in Basic Blöcke gepackt haben:\\ Beginne ab erster unbetrachteter Adresse / Instruktion erneut mit Schritt 1.
    \end{enumerate}
\end{frame}
\clearpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{document} % !!! NICHT ENTFERNEN !!!
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
